{% extends "base.html" %}
{% block title %}Payment History - QGig{% endblock %}
{% block content %}
<div class="container">
    <h1 style="font-size: 2.5rem; font-weight: 700; margin-bottom: 2rem;">
        <i class="fas fa-credit-card"></i> Payment History
    </h1>
    
    <div class="stats-grid" style="margin-bottom: 2rem;">
        <div class="stat-card">
            <div class="stat-value">{{ stats.total_payments }}</div>
            <div class="stat-label">Total Transactions</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ stats.completed }}</div>
            <div class="stat-label">Completed</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ stats.pending }}</div>
            <div class="stat-label">Pending</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">UGX {{ "{:,.0f}".format(stats.total_amount) }}</div>
            <div class="stat-label">Total Amount</div>
        </div>
    </div>
    
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Transaction History</h3>
        </div>
        <div class="card-body" style="padding: 0;">
            <table class="table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Gig</th>
                        <th>{% if current_user.role == 'professional' %}From{% else %}To{% endif %}</th>
                        <th>Amount</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for payment in payments %}
                    <tr>
                        <td>{{ payment.created_at.strftime('%b %d, %Y') }}</td>
                        <td>
                            <a href="{{ url_for('web.gig_detail', gig_id=payment.gig_id) }}" style="color: var(--primary-color);">
                                {{ payment.gig.title }}
                            </a>
                        </td>
                        <td>
                            {% if current_user.role == 'professional' %}
                                {{ payment.institution.institution_name or payment.institution.contact_email or 'Institution' }}
                            {% else %}
                                {{ payment.professional.name or payment.professional.user.email }}
                            {% endif %}
                        </td>
                        <td style="font-weight: 600;">UGX {{ "{:,.0f}".format(payment.amount) }}</td>
                        <td>
                            <span class="badge-status badge-{{ payment.status.value if payment.status else '' }}">
                                {{ payment.status.value|upper if payment.status else '' }}
                            </span>
                        </td>
                        <td>
                            <a href="{{ url_for('web.payment_detail', payment_id=payment.id) }}" class="btn btn-sm btn-outline">
                                <i class="fas fa-eye"></i> View
                            </a>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 3rem; color: var(--gray-500);">
                            <i class="fas fa-receipt" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                            <p>No payment transactions yet</p>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
